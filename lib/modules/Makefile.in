SHELL = /bin/sh

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
moduledir = @moduledir@

DAV_INCLUDES = -I/usr/local/include/neon

i_moduledir = $(install_root)$(moduledir)

include ../modules.def

CC = @CC@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@ -I../../include -DAV_VER=$(interface_version) -D_REENTRANT -D_POSIX_PTHREAD_SEMANTICS $(DAV_INCLUDES)
LD = @LD@

INSTALL = @INSTALL@

.SUFFIXES: .so

.o.so:
	$(CC) -o $@ $(SHARED_LINKFLAGS) $<

modules.o: $(module_objs)
	$(LD) -o modules.o $(module_objs)

so_modules: $(module_sharedobjs)

install: $(module_sharedobjs)
	@../../mkinstalldirs $(i_moduledir)
	rm -f $(i_moduledir)/avfs_module_*.so.*
	@for i in $(module_sharedobjs); do \
	  echo Installing $$i to $(i_moduledir)/avfs_module_$$i; \
	  $(INSTALL) -m 755 $$i $(i_moduledir)/avfs_module_$$i; \
	done

depend:
	cp -f Makefile Makefile.old
	sed '/^# DO NOT REMOVE THIS LINE/q' < Makefile.old > Makefile
	gcc -MM $(CPPFLAGS) *.c >> Makefile

# DO NOT REMOVE THIS LINE, OR "make depend" WILL NOT WORK
