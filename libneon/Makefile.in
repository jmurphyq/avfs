#
# neon source directory Makefile
# 
# Use the NEON_NORMAL_BUILD or NEON_LIBTOOL_BUILD autoconf 
# macros to set up this Makefile correctly.
#

SHELL = @SHELL@

CFLAGS = -I${top_srcdir}/include @CFLAGS@
LDFLAGS = @LDFLAGS@
DEFS = @DEFS@
config_h = ../include/config.h
top_srcdir = @top_srcdir@
CC = @CC@
LD = @LD@
AR = @AR@
RANLIB = @RANLIB@

LIBS = @LIBS@

VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@

LIBTOOL = @LIBTOOL@
LINK = $(LIBTOOL) --quiet --mode=link $(CCLD) $(LDFLAGS)
COMPILE = $(CC) $(DEFS) $(INCLUDES) $(CFLAGS)
NEON_LINK_FLAGS = @NEON_LINK_FLAGS@

OBJECTS = @NEONOBJS@

obj_ext = @NEON_OBJEXT@

.SUFFIXES:
.SUFFIXES: .c .lo .o

NEON_TARGET = @NEON_TARGET@

all: all-@NEON_BUILD_BUNDLED@

all-yes: $(NEON_TARGET)
all-no:
	@echo "Bundled neon build not being used."

.c.lo:
	$(LIBTOOL) --quiet --mode=compile $(COMPILE) -c $< -o $@
.c.o:
	$(COMPILE) -c $< -o $@

libneon.la: $(OBJECTS)
	$(LINK) -rpath $(libdir) $(NEON_LINK_FLAGS) -o $@ $(OBJECTS) $(LIBS)

libneon.a: $(OBJECTS)
	$(AR) cru $@ $(OBJECTS)
	$(RANLIB) $@

clean:
	rm -f @NEONOBJS@ $(NEON_TARGET)

neonreq = http_request.h http_utils.h string_utils.h nsocket.h \
	ne_alloc.h $(config_h)

http_request.$(obj_ext): http_request.c $(neonreq) neon_i18n.h http_private.h

socket.$(obj_ext): socket.c nsocket.h $(config_h) string_utils.h

http_auth.$(obj_ext): http_auth.c http_auth.h string_utils.h \
	$(config_h) dates.h base64.h neon_md5.h

dav_basic.$(obj_ext): dav_basic.c $(neonreq) dav_207.h hip_xml.h

http_basic.$(obj_ext): http_basic.c http_basic.h $(neonreq)

http_utils.$(obj_ext): http_utils.c $(config_h) \
	http_utils.h dates.h

hip_xml.$(obj_ext): hip_xml.c hip_xml.h string_utils.h http_utils.h \
	$(config_h)

dav_207.$(obj_ext): dav_207.c dav_207.h hip_xml.h \
	$(config_h) http_utils.h neon_i18n.h

string_utils.$(obj_ext): string_utils.c string_utils.h ne_alloc.h \
	$(config_h)

ne_alloc.$(obj_ext): ne_alloc.c ne_alloc.h $(config_h)

dates.$(obj_ext): dates.c dates.h $(config_h)

base64.$(obj_ext): base64.c base64.h $(config_h)

uri.$(obj_ext): uri.c uri.h http_utils.h string_utils.h ne_alloc.h \
	$(config_h)

md5.$(obj_ext): md5.c neon_md5.h $(config_h)

dav_props.$(obj_ext): dav_props.c $(config_h) \
	dav_props.h dav_207.h hip_xml.h

dav_locks.$(obj_ext): dav_locks.c $(neonreq) dav_locks.h dav_207.h hip_xml.h

http_redirect.$(obj_ext): http_redirect.c $(neonreq) http_redirect.h \
	uri.h http_private.h

http_cookies.$(obj_ext): http_cookies.c $(neonreq) http_cookies.h uri.h \
	http_private.h
