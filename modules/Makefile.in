SHELL = /bin/sh

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
moduledir = @moduledir@
top_srcdir = @top_srcdir@

CC = @CC@
LD = @LD@
CFLAGS = -I$(top_srcdir)/include @CFLAGS@ @CPPFLAGS@ 

modules = \
	volatile.o   \
	rsh.o        \
	http.o       \
	ftp.o        \
	dav.o        \
	ugz.o        \
	ubz2.o       \
	ugzip.o      \
	ubzip2.o     \
	gz.o         \
	bz2.o        \
	uz.o         \
	uar.o        \
	utar.o       \
	urar.o       \
	uzip.o       \
	floppy.o     \
	extfs.o

modules_objs = \
	$(modules)   \
	mod_static.o \
	dav_ls.o

all: modules.o

modules.o: $(modules_objs)
	$(LD) -o modules.o $(modules_objs)

mod_static.c: make_initmod
	./make_initmod $(modules) > mod_static.c

depend:
	cp -f Makefile Makefile.old
	sed '/^# DO NOT REMOVE THIS LINE/q' < Makefile.old > Makefile
	gcc -MM $(CFLAGS) $(CPPFLAGS) *.c >> Makefile

# DO NOT REMOVE THIS LINE, OR "make depend" WILL NOT WORK
