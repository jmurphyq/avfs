SHELL = /bin/sh

install_scriptcomps = @install_scriptcomps@

initstyle      = @initstyle@
start_levels   = @start_levels@
stop_levels    = @stop_levels@
start_prio     = @start_prio@
stop_prio      = @stop_prio@
i_rcdir        = $(install_root)@rcdir@
rcscriptdir    = @rcscriptdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
sbindir = @sbindir@
bindir = @bindir@

i_profiledir   = $(install_root)@profiledir@
i_sbindir = $(install_root)$(sbindir)
i_bindir = $(install_root)$(bindir)

absrcscriptdir = $(i_rcdir)/$(rcscriptdir)
startname = S$(start_prio)avfscoda
stopname  = K$(stop_prio)avfscoda

i_overlaydir = $(install_root)/overlay
i_devdir = $(install_root)/dev
i_codadev0 = $(i_devdir)/cfs0
i_codadev1 = $(i_devdir)/cfs1
i_emacsstart = $(install_root)/etc/emacs/site-start.d

INSTALL = @INSTALL@

install_initscript:
	@../mkinstalldirs $(i_rcdir)/$(rcscriptdir)
	$(INSTALL) -m 744 init/avfscoda.$(initstyle) $(absrcscriptdir)/avfscoda

install_scriptlinks:
	@for i in $(start_levels); do \
	  ../mkinstalldirs $(i_rcdir)/rc$$i.d; \
	  echo Creating start link for runlevel $$i; \
	  rm -f $(i_rcdir)/rc$$i.d/$(startname); \
	  ln -s ../$(rcscriptdir)/avfscoda $(i_rcdir)/rc$$i.d/$(startname); \
	done
	@for i in $(stop_levels); do \
	  ../mkinstalldirs $(i_rcdir)/rc$$i.d; \
	  echo Creating stop link for runlevel $$i; \
	  rm -f $(i_rcdir)/rc$$i.d/$(stopname); \
	  ln -s ../$(rcscriptdir)/avfscoda $(i_rcdir)/rc$$i.d/$(stopname); \
	done

install_profilescripts:
	@../mkinstalldirs $(i_profiledir)
	$(INSTALL) -m 755 avfscoda.csh $(i_profiledir)/avfscoda.csh
	$(INSTALL) -m 755 avfscoda.sh  $(i_profiledir)/avfscoda.sh

install_avfscodamisc:
	@../mkinstalldirs $(i_overlaydir)
	@../mkinstalldirs $(i_devdir)
	@if ! test -e $(i_codadev0); then mknod -m 600 $(i_codadev0) c 67 0; fi
	@if ! test -e $(i_codadev1); then mknod -m 600 $(i_codadev1) c 67 1; fi

install_emacsscript:
	@../mkinstalldirs $(i_emacsstart)
	$(INSTALL) -m 644 avfscoda.el $(i_emacsstart)/avfscoda.el

install_avfsconfig:
	@../mkinstalldirs $(i_bindir)
	$(INSTALL) -m 755 avfs-config $(i_bindir)/avfs-config

install: $(install_scriptcomps)
	@../mkinstalldirs $(i_bindir)
	$(INSTALL) -m 755 ftppass $(i_bindir)/ftppass
	$(INSTALL) -m 755 davpass $(i_bindir)/davpass

start:
	$(absrcscriptdir)/avfscoda start

